/*
 * main.c
 *
 *  Created on: Jul 9, 2017
 *      Author: ujagaga
 */


#include <avr/io.h>
#include <avr/interrupt.h>
#include <stdint.h>
#include <stdbool.h>
#include <util/delay.h>
#include <avr/wdt.h>
#include "DS18B20.h"
#include "main.h"

#define TARGET_TEMP	(16*70)

void HwInit( void )
{
	//reset watchdog
	wdt_reset();
	//Start watchdog timer with 4s prescaller
	WDTCSR = (1<<WDIE)|(1<<WDE)|(1<<WDP3);
	wdt_enable(WDTO_4S);

	DDRB = 0xFF;
	DDRD = SWITCH_PIN_MASK;

	heaterOff();

	sei();
}

int main( void )
{
	HwInit();

	while(true){
		if(DS_readTemp() < TARGET_TEMP){
			heaterOn();
		}else{
			heaterOff();
		}
	}

	return 0;

}
